#!/bin/sh

# Install paru
git clone https://aur.archlinux.org/paru && cd paru && makepkg -si

# Fast mirrors
sudo reflector -f 30 -l 30 --number 10 --verbose --save /etc/pacman.d/mirrorlist && paru

# Change grub config to load system immediately
sudo sed -i "s/GRUB_TIMEOUT=5/GRUB_TIMEOUT=0/" /etc/default/grub
sudo grub-mkconfig -o /boot/grub/grub.cfg

# Install all necessary packages
paru -S xidlehook calibre discord telegram-desktop timeshift lf redshift ncmpcpp mpd mpc mpv ueberzug pamixer qbittorrent shellcheck codespell openresolv envycontrol speedtest-cli tty-clock-git zramd resolvconf wireguard-tools code npm nodejs autoconf autoconf-archive pkg-config imlib2 libbsd brillo rofi rofi-greenclip rofi-calc devour xclip xsel xdotool brave-bin jackett yt-dlp poppler zip unzip unrar p7zip atool ly farge xcolor bat mullvad-vpn-bin auto-cpufreq bc wget sxiv sxhkd stow pavucontrol feh jq btop alacritty dunst curl nemo zathura zathura-pdf-mupdf noto-fonts-cjk noto-fonts noto-fonts-emoji ttf-linux-libertine ttf-dejavu tstock lazygit zsh zsh-completions flameshot picom-git cmake translate-shell keyd fzf fd beautysh

# Install starship zsh prompt
curl -sS https://starship.rs/install.sh | sh

# Download wallpapers
git clone https://github.com/Tinkerbells/wallpapers.git ~/Pictures/Wallpapers

# Disable nvidia graphics
sudo envycontrol -s integrated

# Default apps
xdg-mime default nemo.desktop inode/directory
xdg-mime default sxiv.desktop image/jpg 
xdg-mime default sxiv.desktop image/png
xdg-mime default sxiv.desktop image/gif
xdg-mime default sxiv.desktop image/gif
xdg-mime default org.pwmt.zathura.desktop application/pdf

# Setup bluetooth
sudo sed -i "s/#Experimental = false/Experimental = true/" /etc/bluetooth/main.conf
sudo sed -i "s/#AutoEnable=false/AutoEnable=true/" /etc/bluetooth/main.conf

# Setup udev rules
sudo cp udev-rules/* /etc/udev/rules.d/
sudo udevadm control --reload-rules

# Enable systemd services
sudo systemctl enable --now zramd
sudo systemctl enable auto-cpufreq
sudo systemctl enable cronie
sudo systemctl enable ly
systemctl --user enable mpd
systemctl --user enable pipewire

# Change npm prefix to local
npm config set prefix ~/.local

# Remove unnecessary files
rm -rf paru

mkdir $HOME/Pictures/Screenshots && mkdir $HOME/Projects

printf "\e[1;32mDone!\e[0m"
